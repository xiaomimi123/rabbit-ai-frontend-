# æµåŠ¨æ€§æ”¶ç›Šæ± æ˜¾ç¤ºé€»è¾‘æ£€æµ‹æŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-09  
**é—®é¢˜**: æµåŠ¨æ€§æ”¶ç›Šæ± æ˜¾ç¤ºå¼‚å¸¸ï¼Œæ•°å­—æ˜¾ç¤ºä¸º "0 1 2 3 4 5 6 7 8 9 . 0 1 2 3 4 5 6 7 8 9..."  
**çŠ¶æ€**: ğŸ” æ£€æµ‹å®Œæˆ

---

## ğŸ” é—®é¢˜åˆ†æ

### DOM ç»“æ„

```
<div class="bg-[#1e2329] border border-white/10 rounded-[2rem] p-8 shadow-2xl relative overflow-hidden">
  æµåŠ¨æ€§æ”¶ç›Šæ±  $ 0 1 2 3 4 5 6 7 8 9 . 0 1 2 3 4 5 6 7 8 9...
  é¢„è®¡æ¯æ—¥æ”¶ç›Š $3.79 USDT
  æŒå¸å¤©æ•° 11 å¤©
  æç°
</div>
```

### æ˜¾ç¤ºé€»è¾‘åˆ†æ

#### 1. ç»„ä»¶ä½ç½®

**æ–‡ä»¶**: `views/AssetView.tsx`  
**è¡Œæ•°**: 843-922

#### 2. æ˜¾ç¤ºæ¡ä»¶

```typescript
{!stats.address || !stats.address.startsWith('0x') ? (
  // æœªè¿æ¥é’±åŒ…ï¼šæ˜¾ç¤º $0.0000
) : earnings === null ? (
  // åŠ è½½ä¸­ï¼šæ˜¾ç¤ºéª¨æ¶å±
) : earningsError ? (
  // é”™è¯¯ï¼šæ˜¾ç¤º --
) : earnings.currentTier > 0 && realTimeEarnings !== null ? (
  // âœ… è¾¾åˆ°VIPç­‰çº§ä¸”å®æ—¶æ”¶ç›Šå·²è®¡ç®—ï¼šä½¿ç”¨RollingNumberç»„ä»¶
  <RollingNumber 
    value={realTimeEarnings} 
    decimals={6} // 6 ä½å°æ•°
    prefix="$"
    className="text-5xl font-black text-white font-mono tracking-tighter"
  />
) : (
  // æœªè¾¾åˆ°VIPç­‰çº§ï¼šæ˜¾ç¤ºé™æ€æ•°å­—
  <span>$ {earnings.pendingUsdt.toFixed(4)}</span>
)}
```

#### 3. å®æ—¶æ”¶ç›Šè®¡ç®—é€»è¾‘

**æ–‡ä»¶**: `views/AssetView.tsx`  
**è¡Œæ•°**: 588-650

```typescript
// å®æ—¶ç´¯è®¡æ”¶ç›Šè®¡ç®— - æ¯5ç§’æ›´æ–°ä¸€æ¬¡
useEffect(() => {
  // æ¡ä»¶æ£€æŸ¥
  if (!earnings || earnings.currentTier === 0 || estimatedDailyEarnings === null || earningsBaseTime === null) {
    return;
  }

  const updateRealTimeEarnings = () => {
    const now = Date.now();
    const timeElapsed = (now - earningsBaseTime) / (1000 * 60); // ç»è¿‡çš„åˆ†é’Ÿæ•°
    const minutesPerDay = 24 * 60;
    
    // è®¡ç®—å¢é‡æ”¶ç›Š
    const incrementalEarnings = estimatedDailyEarnings * (timeElapsed / minutesPerDay);
    
    // å®æ—¶æ”¶ç›Š = åŸºå‡†æ”¶ç›Š + å¢é‡æ”¶ç›Š
    const newRealTimeEarnings = earningsBaseValue + incrementalEarnings;
    
    // é™åˆ¶ï¼šä¸è¶…è¿‡æ¯æ—¥æ”¶ç›Šä¸Šé™
    const maxDailyEarnings = earningsBaseValue + estimatedDailyEarnings;
    const cappedEarnings = Math.min(newRealTimeEarnings, maxDailyEarnings);
    
    setRealTimeEarnings(cappedEarnings);
  };

  updateRealTimeEarnings();
  const intervalId = setInterval(updateRealTimeEarnings, 5000);
  return () => clearInterval(intervalId);
}, [earnings, estimatedDailyEarnings, earningsBaseTime, earningsBaseValue]);
```

#### 4. RollingNumber ç»„ä»¶é€»è¾‘

**æ–‡ä»¶**: `components/RollingNumber.tsx`

```typescript
export const RollingNumber: React.FC<RollingNumberProps> = ({ 
  value, 
  decimals = 4, 
  prefix = "",
  className = "" 
}) => {
  const safeValue = isNaN(value) ? 0 : value;
  const formatted = safeValue.toFixed(decimals); // æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²
  const chars = formatted.split(''); // åˆ†å‰²æˆå­—ç¬¦æ•°ç»„
  
  return (
    <div className={`flex items-baseline ${className}`}>
      {prefix && <span className="mr-1 opacity-80">{prefix}</span>}
      
      {chars.map((char, index) => {
        const isNumber = !isNaN(parseInt(char));
        
        if (isNumber) {
          return <Digit key={index} value={parseInt(char)} />;
        }
        
        return (
          <span key={index} className="inline-block mx-[1px] leading-none">
            {char}
          </span>
        );
      })}
    </div>
  );
};
```

---

## ğŸ› é—®é¢˜æ ¹æºåˆ†æ

### å¯èƒ½çš„åŸå› 

#### 1. **realTimeEarnings å€¼å¼‚å¸¸**

**å¯èƒ½æƒ…å†µ**ï¼š
- `realTimeEarnings` ä¸º `NaN`
- `realTimeEarnings` ä¸º `Infinity`
- `realTimeEarnings` ä¸ºè´Ÿæ•°
- `realTimeEarnings` å€¼è¿‡å¤§

**æ£€æµ‹æ–¹æ³•**ï¼š
```typescript
console.log('realTimeEarnings:', realTimeEarnings);
console.log('isNaN:', isNaN(realTimeEarnings));
console.log('isFinite:', isFinite(realTimeEarnings));
```

#### 2. **RollingNumber ç»„ä»¶æ ¼å¼åŒ–é—®é¢˜**

**é—®é¢˜**ï¼š
- `toFixed(6)` å¯èƒ½äº§ç”Ÿå¼‚å¸¸æ ¼å¼
- `split('')` å¯èƒ½äº§ç”Ÿæ„å¤–çš„å­—ç¬¦æ•°ç»„

**ç¤ºä¾‹**ï¼š
```typescript
// æ­£å¸¸æƒ…å†µ
(123.456789).toFixed(6) // "123.456789"
"123.456789".split('') // ["1", "2", "3", ".", "4", "5", "6", "7", "8", "9"]

// å¼‚å¸¸æƒ…å†µ
(NaN).toFixed(6) // "NaN"
"NaN".split('') // ["N", "a", "N"] - è¿™ä¼šå¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸

(Infinity).toFixed(6) // "Infinity"
"Infinity".split('') // ["I", "n", "f", "i", "n", "i", "t", "y"] - è¿™ä¼šå¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸
```

#### 3. **Digit ç»„ä»¶æ¸²æŸ“é—®é¢˜**

**é—®é¢˜**ï¼š
- å¦‚æœ `char` ä¸æ˜¯æ•°å­—ï¼ˆ0-9ï¼‰ï¼Œ`parseInt(char)` ä¼šè¿”å› `NaN`
- `Digit` ç»„ä»¶æ¥æ”¶ `NaN` ä½œä¸º `value`ï¼Œå¯èƒ½å¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸

**ä»£ç **ï¼š
```typescript
const isNumber = !isNaN(parseInt(char));
if (isNumber) {
  return <Digit key={index} value={parseInt(char)} />;
}
```

**é—®é¢˜**ï¼š
- `parseInt('.')` è¿”å› `NaN`
- `parseInt('N')` è¿”å› `NaN`
- ä½† `!isNaN(parseInt('.'))` ä¸º `false`ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ `Digit` ç»„ä»¶
- ä½†å¦‚æœ `value` æœ¬èº«æ˜¯ `NaN`ï¼Œ`safeValue` ä¼šè¢«è®¾ä¸º `0`ï¼Œä½†æ ¼å¼åŒ–åå¯èƒ½ä»æœ‰é—®é¢˜

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¢å¼º RollingNumber ç»„ä»¶çš„å¥å£®æ€§

```typescript
export const RollingNumber: React.FC<RollingNumberProps> = ({ 
  value, 
  decimals = 4, 
  prefix = "",
  className = "" 
}) => {
  // ğŸ”’ å¢å¼ºï¼šæ›´ä¸¥æ ¼çš„æ•°å€¼éªŒè¯
  let safeValue = 0;
  if (typeof value === 'number' && isFinite(value) && !isNaN(value)) {
    safeValue = Math.max(0, value); // ç¡®ä¿éè´Ÿæ•°
  }
  
  // ğŸ”’ å¢å¼ºï¼šé™åˆ¶æœ€å¤§æ˜¾ç¤ºå€¼ï¼Œé¿å…è¿‡å¤§æ•°å­—
  const MAX_DISPLAY_VALUE = 999999999.999999; // 9äº¿å¤š
  safeValue = Math.min(safeValue, MAX_DISPLAY_VALUE);
  
  const formatted = safeValue.toFixed(decimals);
  const chars = formatted.split('');

  return (
    <div className={`flex items-baseline ${className}`}>
      {prefix && <span className="mr-1 opacity-80">{prefix}</span>}
      
      {chars.map((char, index) => {
        // ğŸ”’ å¢å¼ºï¼šæ›´ä¸¥æ ¼çš„æ•°å­—éªŒè¯
        const numValue = parseInt(char, 10);
        const isNumber = !isNaN(numValue) && numValue >= 0 && numValue <= 9;
        
        if (isNumber) {
          return <Digit key={index} value={numValue} />;
        }
        
        // éæ•°å­—å­—ç¬¦ï¼ˆå¦‚å°æ•°ç‚¹ã€è´Ÿå·ç­‰ï¼‰
        return (
          <span key={index} className="inline-block mx-[1px] leading-none">
            {char}
          </span>
        );
      })}
    </div>
  );
};
```

### æ–¹æ¡ˆ2ï¼šåœ¨ AssetView ä¸­æ·»åŠ éªŒè¯

```typescript
{earnings.currentTier > 0 && realTimeEarnings !== null ? (
  (() => {
    // ğŸ”’ å¢å¼ºï¼šéªŒè¯ realTimeEarnings çš„æœ‰æ•ˆæ€§
    const isValid = typeof realTimeEarnings === 'number' 
      && isFinite(realTimeEarnings) 
      && !isNaN(realTimeEarnings)
      && realTimeEarnings >= 0;
    
    if (!isValid) {
      console.error('[AssetView] Invalid realTimeEarnings:', realTimeEarnings);
      // é™çº§ï¼šæ˜¾ç¤ºé™æ€æ•°å­—
      return (
        <span className="flex items-baseline">
          <span className="text-xl font-normal text-[#848E9C] mr-3">$</span>
          {earnings.pendingUsdt.toFixed(4)}
        </span>
      );
    }
    
    return (
      <RollingNumber 
        value={realTimeEarnings} 
        decimals={6}
        prefix="$"
        className="text-5xl font-black text-white font-mono tracking-tighter"
      />
    );
  })()
) : (
  // æœªè¾¾åˆ°æ ‡å‡†æ—¶ï¼Œæ˜¾ç¤ºé™æ€æ•°å­—
  <span className="flex items-baseline">
    <span className="text-xl font-normal text-[#848E9C] mr-3">$</span>
    {earnings.pendingUsdt.toFixed(4)}
  </span>
)}
```

### æ–¹æ¡ˆ3ï¼šä¿®å¤å®æ—¶æ”¶ç›Šè®¡ç®—é€»è¾‘

```typescript
const updateRealTimeEarnings = () => {
  const now = Date.now();
  const timeElapsed = (now - earningsBaseTime) / (1000 * 60); // ç»è¿‡çš„åˆ†é’Ÿæ•°
  const minutesPerDay = 24 * 60;
  
  // ğŸ”’ å¢å¼ºï¼šéªŒè¯æ‰€æœ‰è¾“å…¥å€¼
  if (!isFinite(estimatedDailyEarnings) || !isFinite(earningsBaseValue) || !isFinite(timeElapsed)) {
    console.error('[AssetView] Invalid values for earnings calculation:', {
      estimatedDailyEarnings,
      earningsBaseValue,
      timeElapsed
    });
    return;
  }
  
  // è®¡ç®—å¢é‡æ”¶ç›Š
  const incrementalEarnings = estimatedDailyEarnings * (timeElapsed / minutesPerDay);
  
  // å®æ—¶æ”¶ç›Š = åŸºå‡†æ”¶ç›Š + å¢é‡æ”¶ç›Š
  const newRealTimeEarnings = earningsBaseValue + incrementalEarnings;
  
  // é™åˆ¶ï¼šä¸è¶…è¿‡æ¯æ—¥æ”¶ç›Šä¸Šé™
  const maxDailyEarnings = earningsBaseValue + estimatedDailyEarnings;
  const cappedEarnings = Math.min(newRealTimeEarnings, maxDailyEarnings);
  
  // ğŸ”’ å¢å¼ºï¼šæœ€ç»ˆéªŒè¯
  if (isFinite(cappedEarnings) && !isNaN(cappedEarnings) && cappedEarnings >= 0) {
    setRealTimeEarnings(cappedEarnings);
  } else {
    console.error('[AssetView] Invalid cappedEarnings:', cappedEarnings);
    // é™çº§ï¼šä½¿ç”¨åŸºå‡†å€¼
    setRealTimeEarnings(earningsBaseValue);
  }
};
```

---

## ğŸ“‹ æ£€æµ‹æ£€æŸ¥æ¸…å•

- [ ] æ£€æŸ¥ `realTimeEarnings` çš„å€¼æ˜¯å¦æœ‰æ•ˆï¼ˆé NaNã€é Infinityã€éè´Ÿæ•°ï¼‰
- [ ] æ£€æŸ¥ `estimatedDailyEarnings` çš„å€¼æ˜¯å¦æœ‰æ•ˆ
- [ ] æ£€æŸ¥ `earningsBaseValue` çš„å€¼æ˜¯å¦æœ‰æ•ˆ
- [ ] æ£€æŸ¥ `earningsBaseTime` çš„å€¼æ˜¯å¦æœ‰æ•ˆ
- [ ] æ£€æŸ¥ `RollingNumber` ç»„ä»¶çš„æ ¼å¼åŒ–é€»è¾‘
- [ ] æ£€æŸ¥ `Digit` ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘
- [ ] æ·»åŠ æ§åˆ¶å°æ—¥å¿—ï¼Œè¿½è¸ªæ•°å€¼å˜åŒ–

---

## ğŸ¯ å»ºè®®çš„ä¿®å¤ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼šå¢å¼º `RollingNumber` ç»„ä»¶çš„å¥å£®æ€§ï¼ˆæ–¹æ¡ˆ1ï¼‰
2. **é«˜ä¼˜å…ˆçº§**ï¼šåœ¨ `AssetView` ä¸­æ·»åŠ éªŒè¯ï¼ˆæ–¹æ¡ˆ2ï¼‰
3. **ä¸­ä¼˜å…ˆçº§**ï¼šä¿®å¤å®æ—¶æ”¶ç›Šè®¡ç®—é€»è¾‘ï¼ˆæ–¹æ¡ˆ3ï¼‰

---

## ğŸ“ æ€»ç»“

**é—®é¢˜**ï¼šæµåŠ¨æ€§æ”¶ç›Šæ± æ˜¾ç¤ºå¼‚å¸¸ï¼Œæ•°å­—æ˜¾ç¤ºä¸º "0 1 2 3 4 5 6 7 8 9 . 0 1 2 3 4 5 6 7 8 9..."

**å¯èƒ½åŸå› **ï¼š
1. `realTimeEarnings` å€¼ä¸º `NaN` æˆ– `Infinity`
2. `RollingNumber` ç»„ä»¶æ ¼å¼åŒ–å¼‚å¸¸
3. `Digit` ç»„ä»¶æ¸²æŸ“å¼‚å¸¸

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. å¢å¼º `RollingNumber` ç»„ä»¶çš„æ•°å€¼éªŒè¯
2. åœ¨ `AssetView` ä¸­æ·»åŠ éªŒè¯é€»è¾‘
3. ä¿®å¤å®æ—¶æ”¶ç›Šè®¡ç®—é€»è¾‘

---

**çŠ¶æ€**: ğŸ” æ£€æµ‹å®Œæˆï¼Œç­‰å¾…ä¿®å¤

