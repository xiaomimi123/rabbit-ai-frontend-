# å‰ç«¯ä¸åç«¯ API æ¥å£å¯¹æ¯”æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2024-12-25  
**å¯¹æ¯”èŒƒå›´**: `rabbit-ai-frontendxin/api.ts` vs `rabbit-ai-backend/src/api/routes/`

---

## âœ… å·²åŒ¹é…çš„ API æ¥å£

### 1. ç”¨æˆ·ä¿¡æ¯ç›¸å…³

| å‰ç«¯è°ƒç”¨ | åç«¯è·¯ç”± | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| `GET /user/info?address=xxx` | `GET /api/user/info` | âœ… åŒ¹é… | è·å–ç”¨æˆ·èƒ½é‡ã€é‚€è¯·æ•°ã€æ¨èäººç­‰ä¿¡æ¯ |
| `GET /user/team-rewards?address=xxx` | `GET /api/user/team-rewards` | âœ… åŒ¹é… | è·å–å›¢é˜Ÿå¥–åŠ±æ€»é¢ |

### 2. èµ„äº§ç›¸å…³

| å‰ç«¯è°ƒç”¨ | åç«¯è·¯ç”± | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| `POST /asset/withdraw/apply` | `POST /api/asset/withdraw/apply` | âœ… åŒ¹é… | ç”³è¯·æç° |
| `GET /asset/withdraw/history?address=xxx` | `GET /api/asset/withdraw/history` | âœ… åŒ¹é… | è·å–æç°å†å² |
| `GET /asset/rat-balance?address=xxx` | `GET /api/asset/rat-balance` | âœ… åŒ¹é… | è·å– RAT ä½™é¢ï¼ˆé“¾ä¸Šè¯»å–ï¼‰ |
| `GET /asset/earnings?address=xxx` | `GET /api/asset/earnings` | âœ… åŒ¹é… | è·å–æŒå¸ç”Ÿæ¯æ”¶ç›Šä¿¡æ¯ |

### 3. æŒ–çŸ¿ç›¸å…³

| å‰ç«¯è°ƒç”¨ | åç«¯è·¯ç”± | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| `POST /mining/verify-claim` | `POST /api/mining/verify-claim` | âœ… åŒ¹é… | éªŒè¯ç©ºæŠ•é¢†å–äº¤æ˜“ |

### 4. å†å²è®°å½•ç›¸å…³

| å‰ç«¯è°ƒç”¨ | åç«¯è·¯ç”± | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| `GET /user/claims?address=xxx` | `GET /api/user/claims` | âœ… åŒ¹é… | è·å–ç©ºæŠ•é¢†å–å†å² |
| `GET /user/referrals?address=xxx` | `GET /api/user/referrals` | âœ… åŒ¹é… | è·å–é‚€è¯·å†å² |

### 5. é€šçŸ¥ç›¸å…³

| å‰ç«¯è°ƒç”¨ | åç«¯è·¯ç”± | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| `GET /user/notifications?address=xxx` | `GET /api/user/notifications` | âœ… åŒ¹é… | è·å–ç”¨æˆ·é€šçŸ¥åˆ—è¡¨ |
| `POST /user/notifications/read` | `POST /api/user/notifications/read` | âœ… åŒ¹é… | æ ‡è®°é€šçŸ¥ä¸ºå·²è¯» |
| `POST /user/notifications/read-all` | `POST /api/user/notifications/read-all` | âœ… åŒ¹é… | æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯» |

### 6. ç³»ç»Ÿé…ç½®ç›¸å…³

| å‰ç«¯è°ƒç”¨ | åç«¯è·¯ç”± | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| `GET /system/links` | `GET /api/system/links` | âœ… åŒ¹é… | è·å–ç³»ç»Ÿé“¾æ¥ï¼ˆç™½çš®ä¹¦ã€å®¡è®¡æŠ¥å‘Šã€å®¢æœï¼‰ |
| `GET /system/announcement` | `GET /api/system/announcement` | âœ… åŒ¹é… | è·å–ç³»ç»Ÿå…¬å‘Š |

---

## ğŸ“Š æ¥å£ç»Ÿè®¡

- **æ€»æ¥å£æ•°**: 14
- **å·²åŒ¹é…**: 14 âœ…
- **æœªåŒ¹é…**: 0
- **åŒ¹é…ç‡**: 100%

---

## ğŸ” è¯¦ç»†å¯¹æ¯”åˆ†æ

### 1. è¯·æ±‚è·¯å¾„æ ¼å¼

**å‰ç«¯**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆ`/user/info`ï¼‰ï¼Œé€šè¿‡ `baseURL: '/api/'` è‡ªåŠ¨æ·»åŠ å‰ç¼€  
**åç«¯**: ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ˆ`/api/user/info`ï¼‰

**ç»“è®º**: âœ… **å®Œå…¨åŒ¹é…**ï¼Œå‰ç«¯ axios é…ç½®ä¼šè‡ªåŠ¨æ·»åŠ  `/api/` å‰ç¼€

### 2. è¯·æ±‚å‚æ•°æ ¼å¼

#### GET è¯·æ±‚å‚æ•°
- **å‰ç«¯**: `?address=${address}` (URL æŸ¥è¯¢å‚æ•°)
- **åç«¯**: ä½¿ç”¨ `UserInfoQuerySchema` éªŒè¯ `req.query.address`
- **ç»“è®º**: âœ… **åŒ¹é…**

#### POST è¯·æ±‚ä½“
- **å‰ç«¯**: `{ address, txHash, referrer }` (JSON å¯¹è±¡)
- **åç«¯**: ä½¿ç”¨ Zod Schema éªŒè¯ `req.body`
- **ç»“è®º**: âœ… **åŒ¹é…**

### 3. å“åº”æ•°æ®æ ¼å¼

#### `/api/user/info`
- **å‰ç«¯æœŸæœ›**: `{ energy: number, inviteCount: number, referrer: string, ... }`
- **åç«¯è¿”å›**: `getUserInfo()` è¿”å›ç›¸åŒç»“æ„
- **ç»“è®º**: âœ… **åŒ¹é…**

#### `/api/asset/earnings`
- **å‰ç«¯æœŸæœ›**: `{ pendingUsdt: string, dailyRate: number, currentTier: number, holdingDays: number }`
- **åç«¯è¿”å›**: åªè¿”å›å‰ç«¯éœ€è¦çš„å­—æ®µï¼ˆå·²è¿‡æ»¤ï¼‰
- **ç»“è®º**: âœ… **åŒ¹é…**

#### `/api/asset/rat-balance`
- **å‰ç«¯æœŸæœ›**: `{ balance: string }`
- **åç«¯è¿”å›**: `{ balance: string }` (æ ¼å¼åŒ–ä¸º 2 ä½å°æ•°)
- **ç»“è®º**: âœ… **åŒ¹é…**

### 4. é”™è¯¯å¤„ç†

#### 404 é”™è¯¯å¤„ç†
- **å‰ç«¯**: å¯¹å¯é€‰ APIï¼ˆå¦‚ `/system/links`, `/system/announcement`ï¼‰é™é»˜å¤„ç† 404ï¼Œè¿”å›é»˜è®¤å€¼
- **åç«¯**: å¯¹æœªé…ç½®çš„æ•°æ®è¿”å› 404
- **ç»“è®º**: âœ… **åŒ¹é…**ï¼Œå‰ç«¯å·²æ­£ç¡®å¤„ç†

#### å…¶ä»–é”™è¯¯å¤„ç†
- **å‰ç«¯**: ä½¿ç”¨ axios æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†é”™è¯¯
- **åç«¯**: ä½¿ç”¨ `toErrorResponse()` ç»Ÿä¸€é”™è¯¯æ ¼å¼
- **ç»“è®º**: âœ… **åŒ¹é…**

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å“åº”æ•°æ®å­—æ®µ

**`/api/user/info` è¿”å›å­—æ®µ**:
- åç«¯è¿”å›: `minEnergyToWithdraw: 30` (å·²ä¿®å¤)
- å‰ç«¯åº”ç¡®ä¿ä½¿ç”¨æ­¤å­—æ®µï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç 

### 2. ç©ºæ•°æ®è¿”å›

**åç«¯è¡Œä¸º**:
- `/api/user/claims`: è¿”å› `[]` è€Œä¸æ˜¯ 404
- `/api/user/referrals`: è¿”å› `[]` è€Œä¸æ˜¯ 404
- `/api/user/notifications`: è¿”å› `[]` è€Œä¸æ˜¯ 404
- `/api/asset/withdraw/history`: è¿”å› `[]` è€Œä¸æ˜¯ 404

**å‰ç«¯è¡Œä¸º**:
- æ‰€æœ‰å†å²è®°å½• API éƒ½æ­£ç¡®å¤„ç†äº† 404ï¼Œè¿”å›ç©ºæ•°ç»„
- **ç»“è®º**: âœ… **åŒ¹é…**

### 3. å¯é€‰ API çš„ 404 å¤„ç†

**åç«¯è¿”å› 404 çš„æƒ…å†µ**:
- `/api/system/links`: å¦‚æœæ‰€æœ‰é“¾æ¥éƒ½ä¸ºç©ºï¼Œè¿”å› 404
- `/api/system/announcement`: å¦‚æœæ²¡æœ‰å…¬å‘Šï¼Œè¿”å› 404

**å‰ç«¯å¤„ç†**:
- `fetchSystemLinks`: 404 æ—¶è¿”å› `null`
- `fetchSystemAnnouncement`: 404 æ—¶è¿”å› `null`
- **ç»“è®º**: âœ… **åŒ¹é…**

---

## ğŸ¯ æ€»ç»“

### âœ… æ‰€æœ‰æ¥å£å®Œå…¨åŒ¹é…

1. **è·¯å¾„æ ¼å¼**: å‰ç«¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡ `baseURL` è‡ªåŠ¨æ·»åŠ  `/api/` å‰ç¼€ï¼Œä¸åç«¯å®Œå…¨åŒ¹é…
2. **è¯·æ±‚å‚æ•°**: GET ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼ŒPOST ä½¿ç”¨ JSON è¯·æ±‚ä½“ï¼Œæ ¼å¼å®Œå…¨åŒ¹é…
3. **å“åº”æ•°æ®**: æ‰€æœ‰æ¥å£çš„å“åº”æ•°æ®ç»“æ„å®Œå…¨åŒ¹é…
4. **é”™è¯¯å¤„ç†**: å‰ç«¯æ­£ç¡®å¤„ç†äº†æ‰€æœ‰é”™è¯¯æƒ…å†µï¼ˆ404ã€400ã€500 ç­‰ï¼‰

### ğŸ“ å»ºè®®

1. **ä¿æŒä¸€è‡´æ€§**: å½“å‰å‰åç«¯æ¥å£å®Œå…¨ç»Ÿä¸€ï¼Œå»ºè®®ç»§ç»­ä¿æŒ
2. **æ–‡æ¡£æ›´æ–°**: å¦‚æœ‰æ–°çš„ API æ¥å£ï¼Œè¯·åŒæ­¥æ›´æ–°å‰ç«¯ `api.ts` å’Œåç«¯è·¯ç”±
3. **ç±»å‹å®šä¹‰**: å»ºè®®åœ¨å‰ç«¯æ·»åŠ  TypeScript ç±»å‹å®šä¹‰ï¼Œç¡®ä¿ç±»å‹å®‰å…¨

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024-12-25  
**å®¡æŸ¥çŠ¶æ€**: âœ… é€šè¿‡

