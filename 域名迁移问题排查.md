# 域名迁移问题排查指南

## 问题描述
修改前端域名为 `rabbitdifi.com` 后，用户点击领取空投后，在后台管理页面看不到数据。

## 可能原因

### 1. 后端 CORS 配置问题 ⚠️ **最可能的原因**

**问题**：后端的 `CORS_ORIGINS` 环境变量没有包含新域名，导致浏览器阻止了 API 请求。

**解决方案**：
1. 登录后端部署平台（如 Render）
2. 找到环境变量配置页面
3. 找到 `CORS_ORIGINS` 环境变量
4. 确保包含新域名，格式如下：
   ```
   CORS_ORIGINS=https://rabbitdifi.com,https://www.rabbitdifi.com,https://旧域名.com
   ```
   ⚠️ **注意**：
   - 必须包含协议 `https://`
   - 多个域名用逗号分隔
   - 不要有空格
   - 如果使用 `*` 允许所有域名，则不需要修改（但生产环境不推荐）

5. 保存后重启后端服务

### 2. 前端 API Base URL 配置问题

**问题**：Vercel 上的 `VITE_API_BASE_URL` 环境变量可能配置错误。

**检查步骤**：
1. 登录 Vercel Dashboard
2. 进入项目设置 -> Environment Variables
3. 检查 `VITE_API_BASE_URL` 的值
4. 确保指向正确的后端地址，例如：
   ```
   https://rabbit-ai-backend.onrender.com
   ```
   ⚠️ **注意**：
   - 不要带末尾的斜杠 `/`
   - 不要包含 `/api` 路径（代码会自动添加）
   - 确保是后端地址，不是前端地址

5. 修改后需要重新部署前端

### 3. 浏览器控制台检查

**检查步骤**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 尝试领取空投
4. 查看是否有以下错误：
   - `CORS policy` 错误 → 说明是 CORS 配置问题
   - `Network Error` → 说明是网络连接问题
   - `404 Not Found` → 说明 API Base URL 配置错误
   - `500 Internal Server Error` → 说明后端服务器错误

5. 切换到 Network 标签
6. 查看 `/api/mining/verify-claim` 请求：
   - 状态码是什么？
   - 响应内容是什么？
   - 请求头中的 `Origin` 是什么？

## 快速诊断脚本

在浏览器控制台运行以下代码，检查配置：

```javascript
// 检查 API Base URL
console.log('API Base URL:', window.location.origin);
console.log('当前域名:', window.location.hostname);

// 检查 API 请求
fetch('/api/health')
  .then(r => r.json())
  .then(data => console.log('API 连接成功:', data))
  .catch(err => console.error('API 连接失败:', err));
```

## 验证步骤

1. **检查后端 CORS 配置**：
   - 确认 `CORS_ORIGINS` 包含 `https://rabbitdifi.com`
   - 重启后端服务

2. **检查前端 API 配置**：
   - 确认 `VITE_API_BASE_URL` 指向正确的后端地址
   - 重新部署前端

3. **测试领取空投**：
   - 使用新域名访问
   - 连接钱包
   - 点击领取空投
   - 查看浏览器控制台是否有错误
   - 检查后台管理页面是否显示数据

## 常见错误和解决方案

### 错误 1: `Access to XMLHttpRequest has been blocked by CORS policy`
**原因**：后端 CORS 配置没有包含新域名  
**解决**：在后端环境变量中添加新域名到 `CORS_ORIGINS`

### 错误 2: `Network Error` 或 `Failed to fetch`
**原因**：API Base URL 配置错误或后端服务不可用  
**解决**：检查 `VITE_API_BASE_URL` 是否正确，检查后端服务是否运行

### 错误 3: `404 Not Found`
**原因**：API Base URL 指向了错误的服务  
**解决**：确保 `VITE_API_BASE_URL` 指向后端地址，不是前端地址

### 错误 4: 请求成功但后台看不到数据
**原因**：可能是数据库写入失败或索引器未同步  
**解决**：检查后端日志，确认数据是否写入数据库

## 联系支持

如果以上步骤都无法解决问题，请提供以下信息：
1. 浏览器控制台的完整错误信息
2. Network 标签中 `/api/mining/verify-claim` 请求的详细信息
3. 后端日志（如果可访问）
4. 前端和后端的部署地址

