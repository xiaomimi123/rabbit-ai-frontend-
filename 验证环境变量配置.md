# 验证环境变量配置

## ✅ 环境变量已配置

从 Vercel 截图可以看到：
- **变量名**: `VITE_API_BASE_URL`
- **值**: `https://rabbit-ai-backend.onr...`（应该是完整的后端 URL）
- **作用域**: All Environments
- **最后更新**: 12/26/25

## 🔍 验证配置是否生效

### 步骤 1: 确认环境变量值完整

在 Vercel Dashboard 中：
1. 点击 `VITE_API_BASE_URL` 变量
2. 确认完整值是：`https://rabbit-ai-backend.onrender.com`
   - ⚠️ **不要带末尾斜杠** `/`
   - ⚠️ **不要包含** `/api`（代码会自动添加）

### 步骤 2: 重新部署前端

**重要**：修改环境变量后，必须重新部署才能生效！

1. 在 Vercel Dashboard 中
2. 进入 "Deployments" 标签
3. 点击 "Redeploy" 按钮
4. 或者推送一次代码触发自动部署

### 步骤 3: 在浏览器中验证

部署完成后，打开前端网站，在浏览器控制台执行：

```javascript
// 方法 1: 检查环境变量（如果代码暴露了）
console.log('=== 检查环境变量 ===');
console.log('VITE_API_BASE_URL:', import.meta.env.VITE_API_BASE_URL);

// 方法 2: 检查实际使用的 API Base URL
// 需要等待页面加载后执行
setTimeout(() => {
  // 检查 getApiBaseUrl 函数返回的值
  import('./api').then(api => {
    const apiBase = api.getApiBaseUrl();
    console.log('实际使用的 API Base URL:', apiBase);
    
    if (apiBase.startsWith('https://')) {
      console.log('✅ 环境变量配置正确！使用完整后端 URL');
    } else if (apiBase === '/api/') {
      console.log('⚠️ 环境变量未生效，仍在使用相对路径');
      console.log('可能原因：');
      console.log('1. 环境变量值不正确');
      console.log('2. 前端代码还没有重新部署');
      console.log('3. 浏览器缓存了旧代码');
    }
  }).catch(err => {
    console.error('无法加载 api 模块:', err);
  });
}, 2000);
```

### 步骤 4: 检查 Network 面板

1. 打开开发者工具（F12）→ Network
2. 刷新页面
3. 查看 API 请求的完整 URL：
   - ✅ **正确**：`https://rabbit-ai-backend.onrender.com/api/...`
   - ❌ **错误**：`https://rabbitdifi.com/api/...`（说明环境变量未生效）

### 步骤 5: 测试访问统计功能

在浏览器控制台执行：

```javascript
// 清除 sessionStorage
sessionStorage.clear();

// 等待页面自动发送请求，或手动测试
const apiBase = import.meta.env.VITE_API_BASE_URL 
  ? `${import.meta.env.VITE_API_BASE_URL}/api` 
  : 'https://rabbit-ai-backend.onrender.com/api';

console.log('测试 API Base URL:', apiBase);

fetch(`${apiBase}/analytics/visit`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    pagePath: '/',
    walletAddress: null,
    referrer: null,
    language: 'zh',
    isMobile: false,
    sessionId: `test_${Date.now()}`
  }),
})
.then(res => res.json())
.then(data => {
  console.log('✅ 测试结果:', data);
  if (data.ok) {
    console.log('🎉 访问统计功能正常！');
  }
})
.catch(err => {
  console.error('❌ 测试失败:', err);
});
```

## 🐛 常见问题

### 问题 1: 环境变量配置了但未生效

**症状**：Network 面板中请求仍然是 `https://rabbitdifi.com/api/...`

**解决方案**：
1. ✅ 确认环境变量值完整且正确
2. ✅ **重新部署前端**（重要！）
3. ✅ 强制刷新浏览器（Ctrl + Shift + R）
4. ✅ 清除浏览器缓存

### 问题 2: 环境变量值格式错误

**错误示例**：
- ❌ `https://rabbit-ai-backend.onrender.com/`（末尾有斜杠）
- ❌ `https://rabbit-ai-backend.onrender.com/api`（包含了 /api）
- ❌ `rabbit-ai-backend.onrender.com`（缺少协议）

**正确格式**：
- ✅ `https://rabbit-ai-backend.onrender.com`

### 问题 3: 浏览器缓存了旧代码

**解决方案**：
1. 按 `Ctrl + Shift + R`（Windows）强制刷新
2. 或者在开发者工具中：
   - 右键点击刷新按钮
   - 选择"清空缓存并硬性重新加载"

## 📊 验证清单

部署并刷新后，检查：

- [ ] 环境变量值完整且正确（`https://rabbit-ai-backend.onrender.com`）
- [ ] 前端已重新部署
- [ ] 浏览器已强制刷新（Ctrl + Shift + R）
- [ ] 控制台显示使用完整后端 URL
- [ ] Network 面板中请求发送到后端 URL
- [ ] 访问统计功能正常工作

---

**最后更新**: 2026-01-03

